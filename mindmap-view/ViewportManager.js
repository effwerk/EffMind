class f{constructor(i){this.mindmapView=i,this.isAnimating=!1,this.animationFrameId=null,this.targetState={scale:this.mindmapView.viewState.scale,panX:this.mindmapView.viewState.panX,panY:this.mindmapView.viewState.panY}}stopAnimation(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.isAnimating=!1}updateView(){this.mindmapView.g&&(this.mindmapView.g.style.willChange!=="transform"&&(this.mindmapView.g.style.willChange="transform"),this.mindmapView.viewState.svgWidth=this.mindmapView.svg.clientWidth,this.mindmapView.viewState.svgHeight=this.mindmapView.svg.clientHeight,this.mindmapView.g.setAttribute("transform",`translate(${this.mindmapView.viewState.panX}, ${this.mindmapView.viewState.panY}) scale(${this.mindmapView.viewState.scale})`),this.mindmapView.dispatch("viewport-changed"))}setView(i){this.mindmapView.viewState.panX=i.panX??this.mindmapView.viewState.panX,this.mindmapView.viewState.panY=i.panY??this.mindmapView.viewState.panY,this.mindmapView.viewState.scale=i.scale??this.mindmapView.viewState.scale,this.updateView()}smoothlyUpdateView(i=.5){this.stopAnimation(),this.isAnimating=!0;const e=()=>{const s=this.mindmapView.viewState,{scale:a,panX:n,panY:m}=s,{scale:h,panX:t,panY:o}=this.targetState,c=a+(h-a)*i,d=n+(t-n)*i,p=m+(o-m)*i;this.setView({panX:d,panY:p,scale:c}),Math.hypot(h-c,t-d,o-p)>.01?this.animationFrameId=requestAnimationFrame(e):(this.setView(this.targetState),this.isAnimating=!1,this.animationFrameId=null)};this.animationFrameId=requestAnimationFrame(e)}centerViewportOnNode(i){this.panViewportToNode(i,0,0)}panToNodeWithOffset(i,e=0,s=0){const a=this.mindmapView.nodeEdit.findNode(i);a&&(this.targetState.panX=this.mindmapView.svg.clientWidth/2-a.x*this.mindmapView.viewState.scale+e,this.targetState.panY=this.mindmapView.svg.clientHeight/2-a.y*this.mindmapView.viewState.scale+s,this.smoothlyUpdateView(.2))}panViewportToNode(i,e=0,s=0,a=.2){const n=this.mindmapView.nodeEdit.findNode(i);if(!n)return;const{clientWidth:m,clientHeight:h}=this.mindmapView.svg,t=this.mindmapView.viewState.scale,o=m/2-n.x*t+e,c=h/2-n.y*t+s;this.targetState.panX=o,this.targetState.panY=c,this.smoothlyUpdateView(a)}getPanForNode(i){const e=this.mindmapView.nodeEdit.findNode(i);if(!e)return null;const{clientWidth:s,clientHeight:a}=this.mindmapView.svg,{scale:n,panX:m,panY:h}=this.mindmapView.viewState,t=s/2-e.x*n,o=a/2-e.y*n;return{x:m-t,y:h-o}}calculateFullContentBounds(i,e=!1){i=i||this.mindmapView.mindMapData;let s=1/0,a=1/0,n=-1/0,m=-1/0;const h=t=>{if(!t||t.width===void 0)return;const o=t.x-t.width/2,c=t.x+t.width/2,d=t.y-t.height/2,p=t.y+t.height/2;s=Math.min(s,o),n=Math.max(n,c),a=Math.min(a,d),m=Math.max(m,p),t.children&&(e||!t._collapsed)&&t.children.forEach(h)};return h(i),s===1/0?{x:0,y:0,width:0,height:0}:{x:s,y:a,width:n-s,height:m-a}}setScale(i){const{scale:e,panX:s,panY:a,maxScale:n,minScale:m}=this.mindmapView.viewState,h=Math.max(m,Math.min(n,i));if(h===e)return;const t=h/e,{clientWidth:o,clientHeight:c}=this.mindmapView.svg;this.targetState.panX=s*t+o/2*(1-t),this.targetState.panY=a*t+c/2*(1-t),this.targetState.scale=h,this.smoothlyUpdateView()}zoomIn(){this.setScale(this.mindmapView.viewState.scale*1.25)}zoomOut(){this.setScale(this.mindmapView.viewState.scale/1.25)}resetView(){this.setScale(1)}handlePinch(i,e,s,a,n,m){const{maxScale:h,minScale:t}=this.mindmapView.viewState,o=this.mindmapView.svg.getBoundingClientRect(),c=e/i,d=s*c,p=Math.min(h,Math.max(t,d)),l=n.x-o.left,w=n.y-o.top,r=p/s,g=l-(l-a.x)*r,S=w-(w-a.y)*r,V=m.x-n.x,v=m.y-n.y;this.targetState.panX=g+V,this.targetState.panY=S+v,this.targetState.scale=p,this.smoothlyUpdateView()}zoomAtPoint(i,e,s){const{scale:a,panX:n,panY:m,maxScale:h,minScale:t}=this.mindmapView.viewState,o=Math.max(t,Math.min(h,i));if(Math.abs(o-a)<1e-5)return;const c=o/a;this.targetState.panX=e-(e-n)*c,this.targetState.panY=s-(s-m)*c,this.targetState.scale=o,this.smoothlyUpdateView()}getNodeBoundingClientRect(i){const e=this.mindmapView.svg.querySelector(`g[data-id="${i}"]`);return e?e.getBoundingClientRect():null}}export{f as default};
