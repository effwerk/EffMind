class y{constructor(e){this.mindmapView=e}get g(){return this.mindmapView.g}render(){!this.g||!this.mindmapView.mindMapData||(this.g.innerHTML="",this.renderLinks(),this._renderNodes())}removeLinks(){this.g.querySelectorAll(".link").forEach(e=>e.remove())}renderLinks(){const e=[],i=t=>{t.children&&!t._collapsed&&t.children.forEach(s=>{s.id===this.mindmapView.interactionState.draggedNodeId&&this.mindmapView.interactionState.potentialParentId||e.push({source:t,target:s}),i(s)})};i(this.mindmapView.mindMapData),e.forEach(t=>{const s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("class","link");const r=t.source.x+t.source.width/2,a=t.source.y,n=t.target.x-t.target.width/2,d=t.target.y;let o;switch(this.mindmapView.currentCurveType){case"straight":o=`M${r},${a} L${n},${d}`;break;case"quadratic_mid_y_offset":const p=(r+n)/2;let g=(a+d)/2+(d>a?30:-30);o=`M${r},${a} Q${p},${g} ${n},${d}`;break;case"cubic_original_horizontal":const c=60;o=`M${r},${a} C${r+c},${a} ${n-c},${d} ${n},${d}`;break;default:const h=.4,l=.5,V=(r+n)/2,m=(a+d)/2,w=r+(n-r)*h,u=a+(m-a)*l,f=n-(n-r)*h,$=d-(d-m)*l;o=`M${r},${a} C${w},${u} ${f},${$} ${n},${d}`;break}s.setAttribute("d",o),this.g.insertBefore(s,this.g.firstChild)})}_renderNodes(){const e=[];let i=null;const t=s=>{this.mindmapView.interactionState.dragging&&s.id===this.mindmapView.interactionState.draggedNodeId?i=s:e.push(s),s.children&&!s._collapsed&&s.children.forEach(t)};t(this.mindmapView.mindMapData),e.forEach(s=>this._appendNodeToG(s)),i&&this._appendNodeToG(i)}_appendNodeToG(e){const i=document.createElementNS("http://www.w3.org/2000/svg","g");i.setAttribute("class","node"),this.mindmapView.interactionState.dragging&&e.id===this.mindmapView.interactionState.draggedNodeId&&this.mindmapView.interactionState.potentialParentId&&i.classList.add("potential-parent-hover"),this.mindmapView.highlightedNodeIds.has(e.id)&&i.classList.add("highlight"),i.setAttribute("transform",`translate(${e.x}, ${e.y})`),i.dataset.id=e.id;const t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("width",e.width),t.setAttribute("height",e.height),t.setAttribute("x",-e.width/2),t.setAttribute("y",-e.height/2),t.setAttribute("class","node-rect"),e.id===this.mindmapView.selectedNodeId&&t.classList.add("selected"),e.id===this.mindmapView.interactionState.potentialParentId&&t.classList.add("drop-target");const s=document.createElementNS("http://www.w3.org/2000/svg","text");if(s.setAttribute("class","node-text"),s.textContent=e.text,i.appendChild(t),i.appendChild(s),e.children&&e.children.length>0){const r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("cx",e.width/2),r.setAttribute("cy",0),r.setAttribute("r",8),r.classList.add("toggle-circle"),r.setAttribute("fill",e._collapsed?"#aaa":"#f0f0f0"),r.setAttribute("stroke","#999"),i.appendChild(r)}this.g.appendChild(i)}updateNodePositions(){const e=i=>{const t=this.g.querySelector(`.node[data-id="${i.id}"]`);t&&t.setAttribute("transform",`translate(${i.x}, ${i.y})`),i.children&&!i._collapsed&&i.children.forEach(e)};e(this.mindmapView.mindMapData)}measureText(e,i){const t=document.createElement("div"),s=getComputedStyle(this.mindmapView.svg);t.style.fontFamily=s.getPropertyValue("--node-text-font-family").trim(),t.style.lineHeight="1.3";const r=i&&i.id==="root";t.style.fontSize=s.getPropertyValue(r?"--node-root-font-size":"--node-font-size").trim(),t.style.fontWeight=s.getPropertyValue(r?"--node-root-font-weight":"--node-font-weight").trim(),t.style.position="absolute",t.style.top="-9999px",t.style.left="-9999px",t.style.width="auto",t.style.whiteSpace="nowrap",t.textContent=e||" ",this.mindmapView.shadowRoot.appendChild(t);const a=t.getBoundingClientRect();return this.mindmapView.shadowRoot.removeChild(t),{width:a.width,height:a.height}}}export{y as default};
