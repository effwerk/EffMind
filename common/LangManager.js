class h{constructor(t){this.source=t,this.translations={}}async load(t){if(this.source)try{const n=await fetch(`${this.source}/${t}.json`);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);this.translations=await n.json()}catch(n){this.translations={},console.warn(`[LangManager] failed to load ${t}.json from ${this.source}`,n)}}T(t,n={}){if(!l._isInitialized)return"";const e=this.translations[t]??t,a=/(@@)|@\{([^{}]+)\}/g;return e.replace(a,(i,o,r)=>o?"@":r!==void 0&&n.hasOwnProperty(r)?n[r]:i)}}const l=new class extends EventTarget{constructor(){super(),this.keyLang="en",this.defaultLang="en",this.currentLang="en",this.subscribers=new Set,this._isInitialized=!1,this.whenInitialized=null,this.translators=new Map,this.globalTranslator=new h(null)}async init({keyLang:s="en",defaultLang:t,source:n=null}={}){if(this.whenInitialized)return this.whenInitialized;const e=async()=>{this._isInitialized||(this.keyLang=s,this.defaultLang=t||s,this.currentLang=this.defaultLang,n&&(this.globalTranslator.source=n,this.translators.set(n,this.globalTranslator)),this.currentLang!==this.keyLang&&await this._loadAll(this.currentLang),document.documentElement.lang=this.currentLang,this._isInitialized=!0,this.notify())};return this.whenInitialized=e(),this.whenInitialized}_getOrCreateTranslator(s){if(!this.translators.has(s)){const t=new h(s);this.translators.set(s,t),this.currentLang!==this.keyLang&&t.load(this.currentLang).then(()=>{this.notify()})}return this.translators.get(s)}setSource(s){const t=this._getOrCreateTranslator(s);return t.T.bind(t)}async _loadAll(s){const t=[this.globalTranslator,...this.translators.values()],n=[...new Set(t)];await Promise.all(n.map(e=>e.load(s)))}subscribe(s){this.subscribers.add(new WeakRef(s)),this._isInitialized&&s.requestUpdate&&s.requestUpdate()}unsubscribe(s){for(const t of this.subscribers)if(t.deref()===s){this.subscribers.delete(t);break}}notify(){this.subscribers.forEach(s=>{const t=s.deref();t?t.requestUpdate&&t.requestUpdate():this.subscribers.delete(s)})}async setLang(s){if(this.currentLang=s,s===this.keyLang){const t=[this.globalTranslator,...this.translators.values()];[...new Set(t)].forEach(e=>e.translations={})}else await this._loadAll(s);this.notify(),this.dispatchEvent(new CustomEvent("change",{detail:{lang:this.currentLang}}))}},u=(s,t)=>l.globalTranslator.T(s,t);async function d(s,t,n,e){let a={},i,o;await l.whenInitialized,typeof t=="function"?(i=t,o=n):(a=t||{},i=n,o=e);let r=u(s,a);const c=()=>{o?.()||(r=u(s,a),i?.(r))};return l.addEventListener("change",c),r}export{l as LangManager,d as ReactiveT,u as T};
