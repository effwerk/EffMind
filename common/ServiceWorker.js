(()=>{const c="v1.2.0",i=`app-cache-${c}`,l=["/MindmapMain.js","/appicon.png","/common/.DS_Store","/common/ComponentAPI.js","/common/LRUCache.js","/common/LangManager.js","/common/MindmapBaseElement.js","/common/NodeTextManager.js","/common/ServiceWorker.js","/common/Storage.js","/common/Utils.js","/common/icons/addChildNode.svg","/common/icons/addSiblingNode.svg","/common/icons/arrowRight.svg","/common/icons/clear.svg","/common/icons/close.svg","/common/icons/deleteNode.svg","/common/icons/menu.svg","/common/icons/more.svg","/common/icons/search.svg","/common/lit.js","/common/svg-icon.js","/contextMenuItems.js","/favicon.ico","/favicon.svg","/index.css","/index.html","/index.js","/langs/de.json","/langs/nl.json","/langs/zhs.json","/langs/zht.json","/manifest.json","/menuItems.js","/mindmap-context-menu.js","/mindmap-main.js","/mindmap-menu.js","/mindmap-minimap.js","/mindmap-search.js","/mindmap-view/ImportExport.js","/mindmap-view/InteractionManager.js","/mindmap-view/LayoutManager.js","/mindmap-view/NodeEdit.js","/mindmap-view/NodeHistory.js","/mindmap-view/Renderer.js","/mindmap-view/ViewportManager.js","/mindmap-view.js","/node-quick-menu.js"];async function o(e){const n=await self.clients.matchAll({includeUncontrolled:!0});for(const s of n)s.postMessage(e)}self.addEventListener("install",e=>{console.log(`[SW] Installing version ${c}...`),o({type:"SW_UPDATE_STATUS",stage:"installing",progress:0}),e.waitUntil(caches.open(i).then(async n=>{let s=0;const r=l.length;for(const t of l)try{const a=await fetch(t);await n.put(t,a.clone()),s++;const m=Math.round(s/r*100);console.log(`[SW] Caching ${t} (${m}%)`),o({type:"SW_UPDATE_STATUS",stage:"installing",progress:m,current:t})}catch(a){console.warn(`[SW] Failed to cache ${t}`,a)}}).then(()=>{console.log("[SW] Install complete"),o({type:"SW_UPDATE_STATUS",stage:"installed",progress:100})})),self.skipWaiting()});self.addEventListener("activate",e=>{console.log(`[SW] Activating version ${c}...`),o({type:"SW_UPDATE_STATUS",stage:"activating"}),e.waitUntil((async()=>{const n=await caches.keys();for(const s of n)s!==i&&(console.log(`[SW] Deleting old cache: ${s}`),await caches.delete(s));await self.clients.claim(),console.log("[SW] Activation complete"),o({type:"SW_UPDATE_STATUS",stage:"activated"})})())});self.addEventListener("fetch",e=>{e.request.method==="GET"&&e.respondWith((async()=>{try{const n=await fetch(e.request);return(await caches.open(i)).put(e.request,n.clone()),n}catch{return await caches.match(e.request)||Response.error()}})())});self.addEventListener("message",async e=>{e.data==="SKIP_WAITING"&&(console.log("[SW] Forcing update..."),o({type:"SW_UPDATE_STATUS",stage:"skipping_waiting"}),await self.skipWaiting())});})();
